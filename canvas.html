<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<title></title>
<!-- 		<link rel="stylesheet" type="text/css" href="style.css"> -->
		<script src="jquery.min.js" type="text/javascript"></script>
		<script src="jquery-ui.min.js" type="text/javascript"></script>
		<script src="2dslider.js" type="text/javascript"></script>
<!-- 		<script src="context_blender.js" type="text/javascript"></script> -->

		<script src="BlobBuilder.js" type="text/javascript"></script>
		<script src="FileSaver.js" type="text/javascript"></script>
		<script src="canvas-toBlob.js" type="text/javascript"></script>
<style type="text/css">
canvas {
	position: absolute; left: 0px; top: 0px;
}
.logo {
	width: 304px;
	height: 38px;
	position: relative;
	margin: 0px auto;
	background: url("patternomatic.png") 0px 0px no-repeat;
}
.controls {
	width: 776px;
	position: relative;
	margin: 50px auto 0px auto;
}
.controls #hueslider {
	position: absolute;
	left: 11px;
	top: 48px;
}
.controls #saturationslider {
	position: absolute;
	left: 209px;
	top: 14px;
}
.controls #pixelsslider {
	position: absolute;
	left: 367px;
	top: 48px;
}
.controls #pixels {
	position: absolute;
	left: 474px;
	top: 0px;
}
.controls #noiseslider {
	position: absolute;
	left: 649px;
	top: 69px;
}
.controls #highlightslider {
	position: absolute;
	left: 649px;
	top: 27px;
}

.ui-slider-handle {
    outline: none;
}
#hueslider {
	width: 156px;
	height: 22px;
}
#hueslider .ui-slider-bg {
	height: 22px;
	position: absolute;
	left: -11px;
	right: -11px;
	z-index: 1;
	background: url("ui-slider-bg.png") 0px 0px no-repeat;
}
#pixelsslider {
	width: 76px;
	height: 22px;
}
#pixelsslider .ui-slider-bg {
	height: 22px;
	position: absolute;
	left: -11px;
	right: -11px;
	z-index: 1;
	background: url("ui-slider-bg.png") 0px -66px no-repeat;
}
#noiseslider {
	width: 116px;
	height: 22px;
}
#noiseslider .ui-slider-bg {
	height: 22px;
	position: absolute;
	left: -11px;
	right: -11px;
	z-index: 1;
	background: url("ui-slider-bg.png") 0px -22px no-repeat;
}
#highlightslider {
	width: 116px;
	height: 22px;
}
#highlightslider .ui-slider-bg {
	height: 22px;
	position: absolute;
	left: -11px;
	right: -11px;
	z-index: 1;
	background: url("ui-slider-bg.png") 0px -44px no-repeat;
}
#hueslider .ui-slider-handle, #highlightslider .ui-slider-handle, #noiseslider .ui-slider-handle, #pixelsslider .ui-slider-handle {
	width: 20px;
	height: 20px;
	position: absolute;
	z-index: 2;
	margin: 1px 0px 1px -10px;
	background: url("ui-slider-handle.png") 0px 0px no-repeat;
}
#saturationslider {
	width: 100px;
	height: 100px;
	margin: 0px;
	border-radius: 2px;
	background: -webkit-gradient(linear, 10% top, right top, 
		from(hsl(208, 100%, 50%)), 
		to(hsl(208, 0%, 50%))
	);
}
#saturationslider .ui-slider-bg {
	position: absolute;
	left: -9px;
	right: -9px;
	top: -9px;
	bottom: -9px;
	z-index: 1;
	background: url("ui-2dslider-bg.png") 0px 0px no-repeat;
}
#saturationslider .ui-slider-handle {
	width: 20px;
	height: 20px;
	position: absolute;
	z-index: 2;
	margin: 0px 0px -10px -10px;
	background: url("ui-slider-handle.png") -20px 0px no-repeat;
}


.ui-pixels-row {
	width: 126px;
	height: 18px;
	position: relative;
}
.ui-pixels-pixel {
	float: left;
	width: 18px;
	height: 18px;
	background: url("ui-pixels-pixel.png") 0px 0px no-repeat;
}
.ui-pixels-pixel-on {
	background: url("ui-pixels-pixel.png") -18px 0px no-repeat;
}

.ui-pixels-6_rows .ui-pixels-row:first-child {
	margin-top: 9px;
}
.ui-pixels-6_rows .ui-pixels-row {
	margin-left: 9px;
}
.ui-pixels-5_rows .ui-pixels-row:first-child {
	margin-top: 18px;
}
.ui-pixels-5_rows .ui-pixels-row {
	margin-left: 18px;
}
.ui-pixels-4_rows .ui-pixels-row:first-child {
	margin-top: 27px;
}
.ui-pixels-4_rows .ui-pixels-row {
	margin-left: 27px;
}
.ui-pixels-3_rows .ui-pixels-row:first-child {
	margin-top: 36px;
}
.ui-pixels-3_rows .ui-pixels-row {
	margin-left: 36px;
}

.ui-pixels-6_rows .ui-pixels-pixel-ring_6 {
/* 	display: none; */
	visibility: hidden;
}
.ui-pixels-5_rows .ui-pixels-pixel-ring_6, .ui-pixels-5_rows .ui-pixels-pixel-ring_5 {
/* 	display: none; */
	visibility: hidden;
}
.ui-pixels-4_rows .ui-pixels-pixel-ring_6, .ui-pixels-4_rows .ui-pixels-pixel-ring_5, .ui-pixels-4_rows .ui-pixels-pixel-ring_4 {
/* 	display: none; */
	visibility: hidden;
}
.ui-pixels-3_rows .ui-pixels-pixel-ring_6, .ui-pixels-3_rows .ui-pixels-pixel-ring_5, .ui-pixels-3_rows .ui-pixels-pixel-ring_4, .ui-pixels-3_rows .ui-pixels-pixel-ring_3 {
/* 	display: none; */
	visibility: hidden;
}


</style>

		<script type="text/javascript">
$(function () {
	$.widget("ui.foobar", {
		options: {
			patternsize: 0,
			pattern: [],
			hue: 0,
			saturation: 0,
			lightness: 0,
			highlight: 0,
			noise: 0,
		},
		_create: function() {
			this.element.append('<canvas class="molecule"></canvas>');
			this.element.append('<canvas class="noise"></canvas>');
			this.setnoise();
			this.element.append('<canvas class="tile"></canvas>');
			this.element.append('<canvas class="background"></canvas>');
		},
		_init: function() {
			this.setmolecule();
			this.settile();
			this.setbackground();

			var fivebin = 0;
			var patb36 = "";
			for (var i=0; i<49; i+=5) {

				var fivebin = 0;
				for (var j in this.options.pattern.slice(i,i+5)) {
					fivebin = fivebin +(this.options.pattern.slice(i,i+5)[j]?1:0)*Math.pow(10,4-j);
				}
				patb36 = patb36+parseInt(fivebin, 2).toString(36);
			}
			console.log(patb36);
		},
		setmolecule: function() {
			var preset = this.options;

			if (this.element.children(".molecule")[0].getContext) {
				var ctx = this.element.children(".molecule")[0].getContext('2d');
			
				this.element.children(".molecule")[0].width = preset.patternsize;
				this.element.children(".molecule")[0].height = preset.patternsize;
			
				ctx.fillStyle = ("hsl("+preset.hue+","+preset.saturation+"%,"+preset.lightness+"%)");
				ctx.fillRect(0, 0, 1000, 1000);
			
				for (y=0; y<7; y++) {
					if (y>=preset.patternsize) continue;
			
					for (x=0; x<7; x++) {
						if (x>=preset.patternsize) continue;
			
						if (!preset.pattern[y*7+x]) continue;
			
						ctx.fillStyle = ("hsl("+preset.hue+","+preset.saturation+"%,"+Math.min(100,preset.lightness+preset.highlight)+"%)");
						ctx.fillRect(x, y, 1, 1);
					}
				}
			}
		},
		setnoise: function() {
			if (this.element.children(".noise")[0].getContext) {
				this.element.children(".noise")[0].width = 280;
				this.element.children(".noise")[0].height = 280;

				var ctx = this.element.children(".noise")[0].getContext('2d');

				ctx.fillStyle = ("white");
				ctx.fillRect(0, 0, 280, 280);

				var imageData = ctx.getImageData(0, 0, 280, 280);
				var pixels = imageData.data;

				for (var i = 0, il = pixels.length; i < il; i += 4) {
					// generate "noise" pixel
					var color = Math.ceil(Math.random() * 255*0.75 + 255*0.25);
				
					pixels[i] =     color;
					pixels[i + 1] = color;
					pixels[i + 2] = color;
				}
	
				ctx.putImageData(imageData, 0, 0);
			}
		},
		settile: function() {
			var preset = this.options;
		
			if (this.element.children(".tile")[0].getContext) {
				var ctx = this.element.children(".tile")[0].getContext('2d');
			
				if (preset.patternsize == 7) {
					this.element.children(".tile")[0].width = 280;
					this.element.children(".tile")[0].height = 280;
				} else {
					this.element.children(".tile")[0].width = 240;
					this.element.children(".tile")[0].height = 240;
				}
			
				var img=this.element.children(".molecule")[0];
				var pat=ctx.createPattern(img,"repeat");
			
				ctx.fillStyle = pat;
				ctx.fillRect(0, 0, 280, 280);
			}

			var noisectx = this.element.children(".noise")[0].getContext('2d');
			var noiseData = noisectx.getImageData(0, 0, this.element.children(".noise")[0].width, this.element.children(".noise")[0].height);
			var noisepixels = noiseData.data;
			
			// Get image pixels
			var imageData = ctx.getImageData(0, 0, this.element.children(".tile")[0].width, this.element.children(".tile")[0].height);
			var pixels = imageData.data;
			
			var alpha = preset.noise/100;
			var alpha1 = 1 - alpha;
			
			for (var i = 0, il = pixels.length; i < il; i += 4) {
			  // generate "noise" pixel
/* 				var color = Math.ceil(Math.random() * 255*0.75 + 255*0.25); */
			
				oR = pixels[i];
				oG = pixels[i + 1];
				oB = pixels[i + 2];

				nR = noisepixels[i];
				nG = noisepixels[i + 1];
				nB = noisepixels[i + 2];
			
/*
				pixels[i] =     color * alpha + oR * alpha1;
				pixels[i + 1] = color * alpha + oG * alpha1;
				pixels[i + 2] = color * alpha + oB * alpha1;
*/
				pixels[i] =     nR * alpha + oR * alpha1;
				pixels[i + 1] = nG * alpha + oG * alpha1;
				pixels[i + 2] = nB * alpha + oB * alpha1;
			}
			
			ctx.putImageData(imageData, 0, 0);
		},
		downloadtile: function() {
			this.element.children(".tile")[0].toBlob(function(blob) {
			    saveAs(blob, "background-o-matic.png");
			});
		},
		setbackground: function() {
			if (this.element.children(".background")[0].getContext) {
				var ctx = this.element.children(".background")[0].getContext('2d');
			
				this.element.children(".background")[0].width = window.innerWidth;
				this.element.children(".background")[0].height = window.innerHeight;
			
				var pat=ctx.createPattern(this.element.children(".tile")[0],"repeat");
			
				ctx.fillStyle = pat;
				ctx.fillRect(0, 0, 10000, 10000);
			}
		},
	});

	$.widget("ui.pixels", {
		options: {
			patternsize: 0,
			pattern: [],
		},
		_create: function() {
			var row;

			this.change = this.options.change;

			this.element.addClass("ui-pixels")
				.addClass("ui-pixels-4_rows");

			for (var y = 0; y < 7; y++) {
				row = $('<div class="ui-pixels-row"></div>').appendTo(this.element);

				for (var x = 0; x < 7; x++) {
					this.createpixel(x, y).appendTo(row);
				}
			}
		},
		_init: function() {
			this.element
				.removeClass("ui-pixels-3_rows")
				.removeClass("ui-pixels-4_rows")
				.removeClass("ui-pixels-5_rows")
				.removeClass("ui-pixels-6_rows")
				.removeClass("ui-pixels-7_rows")
				.addClass("ui-pixels-"+this.options.patternsize+"_rows");
		},
		createpixel: function(x, y) {
			return $('<div class="ui-pixels-pixel"></div>')
				.addClass("ui-pixels-pixel-at_"+x+"_"+y)
				.addClass("ui-pixels-pixel-ring_"+Math.max(x, y))
				.toggleClass("ui-pixels-pixel-on", this.options.pattern[y*7+x])
				.click(function() {
					$(this).toggleClass("ui-pixels-pixel-on");
					$(this).parents(".ui-pixels").pixels("resetpreset", null);
				});
		},
		resetpreset: function() {
			this.options.pattern = $.map($(this.element).find(".ui-pixels-pixel"), function (a) {
				return $(a).hasClass("ui-pixels-pixel-on");
			});
			this.change();
		}
	});

/*
	var preset = {
		hue: 207,
		saturation: 50,
		lightness: 25,
		highlight: 4,
		noise: 8,
		patternsize: 5,
		pattern: [
			true, true, false, true, false, false, false,
			true, true, false, true, false, false, false,
			true, true, false, true, false, false, false,
			true, true, false, true, false, false, false,
			true, true, false, true, false, false, false,
			false, false, false, false, false, false, false,
			false, false, false, false, false, false, false
		],
		file: "0d71ed6e5cfbf61dc4c73f04e8b76237_final.png"
	}
*/

	var preset = {
		hue: 219,
		saturation: 13,
		lightness: 22,
		highlight: 4,
		noise: 8,
		patternsize: 4,
		pattern: [
			true, true, true, false, false, false, false,
			true, true, false, true, false, false, false,
			true, false, true, true, false, false, false,
			false, true, true, true, false, false, false,
			false, false, false, false, false, false, false,
			false, false, false, false, false, false, false,
			false, false, false, false, false, false, false
		],
	}


	$("#tile").foobar(preset);
/*
	window.resize(function() {
		$("#tile").foobar(preset);
	});
*/

	$("#hueslider").slider({orientation: "horizontal", min: 0, max: 360, value: preset.hue,
		slide: function(event, ui) {
			preset.hue = ui.value;
			$("#tile").foobar(preset);
			$("#saturationslider").css("background", "url('g6728.png') left -28px no-repeat, -webkit-gradient(linear, left top, right top, from(hsl("+preset.hue+", 100%, 50%)), to(hsl("+preset.hue+", 0%, 50%)))");
		}
	}).append('<div class="ui-slider-bg"></div>');

	$("#saturationslider").squiggles({valueX: 100-preset.saturation, valueY: preset.lightness, 
		slide: function(event, ui) {
			preset.saturation = 100-ui.value.x;
			preset.lightness = ui.value.y;
			$("#tile").foobar(preset);
		}
	}).append('<div class="ui-slider-bg"></div>');

	$("#pixelsslider").slider({orientation: "horizontal", min: 3, max: 7, step: 1, value: preset.patternsize, 
		slide: function(event, ui) {
			preset.patternsize = ui.value;
			$("#pixels").pixels({patternsize: preset.patternsize, pattern: preset.pattern});
			$("#tile").foobar(preset);
		}
	}).append('<div class="ui-slider-bg"></div>');

	$("#pixels").pixels({patternsize: preset.patternsize, pattern: preset.pattern,
		change: function(event, ui) {
			preset.pattern = this.options.pattern;
			$("#tile").foobar(preset);
		}
	});

	$("#noiseslider").slider({orientation: "horizontal", min: 0, max: 12, step: 0.01, value: preset.noise, 
		slide: function(event, ui) {
			preset.noise = ui.value;
			$("#tile").foobar(preset);
		}
	}).append('<div class="ui-slider-bg"></div>');

	$("#highlightslider").slider({orientation: "horizontal", min: 0, max: 12, step: 0.01, value: preset.highlight, 
		slide: function(event, ui) {
			preset.highlight = ui.value;
			$("#tile").foobar(preset);
		}
	}).append('<div class="ui-slider-bg"></div>');

	$("#download").click(function(event, ui) {
		$("#tile").foobar("downloadtile", preset);
	});
});
		</script>


	</head>
	<body>
		<div id="tile"></div>
		<div class="logo"></div>
		<div class="controls">
			<div id="hueslider"></div>
			<div id="saturationslider"></div>
			<div id="pixelsslider"></div>
			<div id="pixels"></div>
			<div id="noiseslider"></div>
			<div id="highlightslider"></div>
		</div>

		<span id="download" style="position: relative;">download</span>
	</body>
</html>