$(function(){$.widget("ui.foobar",{options:{patternsize:0,pattern:[],hue:0,saturation:0,lightness:0,highlight:0,noise:0,},_create:function(){this.element.append('<canvas class="molecule"></canvas>');this.element.append('<canvas class="noise"></canvas>');this.setnoise();this.element.append('<canvas class="tile"></canvas>');this.element.append('<canvas class="background"></canvas>')},_init:function(){this.setmolecule();this.settile();this.setbackground()},setmolecule:function(){var h=this.options;if(this.element.children(".molecule")[0].getContext){var g=this.element.children(".molecule")[0].getContext("2d");this.element.children(".molecule")[0].width=h.patternsize;this.element.children(".molecule")[0].height=h.patternsize;g.fillStyle=("hsl("+h.hue+","+h.saturation+"%,"+h.lightness+"%)");g.fillRect(0,0,7,7);for(y=0;y<7;y++){if(y>=h.patternsize){continue}for(x=0;x<7;x++){if(x>=h.patternsize){continue}if(!h.pattern[y*7+x]){continue}g.fillStyle=("hsl("+h.hue+","+h.saturation+"%,"+Math.min(100,h.lightness+h.highlight)+"%)");g.fillRect(x,y,1,1)}}}},setnoise:function(){if(this.element.children(".noise")[0].getContext){this.element.children(".noise")[0].width=280;this.element.children(".noise")[0].height=280;var g=this.element.children(".noise")[0].getContext("2d");g.fillStyle=("white");g.fillRect(0,0,280,280);var m=g.getImageData(0,0,280,280);var l=m.data;for(var k=0,j=l.length;k<j;k+=4){var h=Math.ceil(Math.random()*255*0.75+255*0.25);l[k]=h;l[k+1]=h;l[k+2]=h}g.putImageData(m,0,0)}},settile:function(){var r=this.options;if(this.element.children(".tile")[0].getContext){var t=this.element.children(".tile")[0].getContext("2d");if(r.patternsize==7){this.element.children(".tile")[0].width=280;this.element.children(".tile")[0].height=280}else{this.element.children(".tile")[0].width=240;this.element.children(".tile")[0].height=240}var m=this.element.children(".molecule")[0];var n=t.createPattern(m,"repeat");t.fillStyle=n;t.fillRect(0,0,280,280)}var h=this.element.children(".noise")[0].getContext("2d");var s=h.getImageData(0,0,this.element.children(".noise")[0].width,this.element.children(".noise")[0].height);var p=s.data;var g=t.getImageData(0,0,this.element.children(".tile")[0].width,this.element.children(".tile")[0].height);var j=g.data;var k=r.noise/100;var q=1-k;for(var l=0,o=j.length;l<o;l+=4){oR=j[l];oG=j[l+1];oB=j[l+2];nR=p[l];nG=p[l+1];nB=p[l+2];j[l]=nR*k+oR*q;j[l+1]=nG*k+oG*q;j[l+2]=nB*k+oB*q}t.putImageData(g,0,0)},downloadtile:function(){var g=f(this.options);_gaq.push(["_trackEvent","Download","Download",g]);this.element.children(".tile")[0].toBlob(function(h){saveAs(h,"patternomatic_"+g+".png")})},setbackground:function(){if(this.element.children(".background")[0].getContext){var g=this.element.children(".background")[0].getContext("2d");this.element.children(".background")[0].width=$(document).width();this.element.children(".background")[0].height=$(document).height();var h=g.createPattern(this.element.children(".tile")[0],"repeat");g.fillStyle=h;g.fillRect(0,0,4000,3000)}},});$.widget("ui.pixels",{options:{patternsize:0,pattern:[],},_create:function(){var h;this.change=this.options.change;this.element.addClass("ui-pixels").addClass("ui-pixels-4_rows");for(var i=0;i<7;i++){h=$('<div class="ui-pixels-row"></div>').appendTo(this.element);for(var g=0;g<7;g++){this.createpixel(g,i).appendTo(h)}}},_init:function(){this.element.removeClass("ui-pixels-3_rows").removeClass("ui-pixels-4_rows").removeClass("ui-pixels-5_rows").removeClass("ui-pixels-6_rows").removeClass("ui-pixels-7_rows").addClass("ui-pixels-"+this.options.patternsize+"_rows")},pixels:function(j){for(var h=0;h<49;h++){var g=h%7;var k=Math.floor(h/7);this.element.find(".ui-pixels-pixel-at_"+g+"_"+k).toggleClass("ui-pixels-pixel-on",j[h])}},createpixel:function(g,h){return $('<div class="ui-pixels-pixel"></div>').addClass("ui-pixels-pixel-at_"+g+"_"+h).addClass("ui-pixels-pixel-ring_"+Math.max(g,h)).toggleClass("ui-pixels-pixel-on",this.options.pattern[h*7+g]).click(function(){$(this).toggleClass("ui-pixels-pixel-on");$(this).parents(".ui-pixels").pixels("resetpreset",null)})},resetpreset:function(){this.options.pattern=$.map($(this.element).find(".ui-pixels-pixel"),function(g){return $(g).hasClass("ui-pixels-pixel-on")});this.change()}});function f(u){try{b(u)}catch(h){throw"can't encode hash, preset is invalid: "+h}var F=Math.round(u.hue);var p=Math.round(u.saturation);var q=Math.round(u.lightness);var v=Math.round(u.highlight);var g=Math.round(u.noise);var D=u.patternsize;var w=u.pattern;var l="";var r=false;var z="";var n=false;var s="";var A=false;var E="";var t=false;var C="";if(F>=100){l=F.toString()}else{if(F>=10){l="0"+F.toString()}else{l="00"+F.toString()}}if(p==100){r=true;z="00"}else{if(p>=10){z=p.toString()}else{z="0"+p.toString()}}if(q==100){n=true;s="00"}else{if(q>=10){s=q.toString()}else{s="0"+q.toString()}}if(v>=10){A=true;E=parseInt(v-10).toString()}else{E=v.toString()}if(g>=10){t=true;C=parseInt(g-10).toString()}else{C=g.toString()}var k=D-3;var o=0;for(var B=0;B<49;B++){if(w[B]){o+=Math.pow(2,48-B)}}var j=parseInt(o,10).toString(36);var m=parseInt(l+z+s+E+C+parseInt((r?4:0)+(n?2:0)+(A?1:0),10).toString()+parseInt((t?5:0)+k,10).toString(),10).toString(36);while(m.length<7){m="0"+m}while(j.length<10){j="0"+j}return m+j}function a(h){if(h.length!=17){throw"can't decode hash, hash is wrong"}var n=h.substr(0,7);var k=h.substr(7,10);var s=parseInt(n,36).toString(10);while(s.length<11){s="0"+s}var l=s.substr(0,3);var w=s.substr(3,2);var t=s.substr(3+2,2);var E=s.substr(3+2+2,1);var B=s.substr(3+2+2+1,1);var g=s.substr(3+2+2+1+1,1);var q=g==4||g==5||g==6||g==7;var m=g==2||g==3||g==6||g==7;var z=g==1||g==3||g==5||g==7;var r=s.substr(3+2+2+1+1+1,1);var u=r>4;var D=r;var p=parseInt(k,36).toString(10);var C=new Array;for(var A=0;A<49;A++){var o=Math.pow(2,48-A);C[A]=(p>=o);if(p>=o){p-=o}}var v={hue:parseInt(l,10),saturation:parseInt(w,10)+(q?100:0),lightness:parseInt(t,10)+(m?100:0),highlight:parseInt(E,10)+(z?10:0),noise:parseInt(B,10)+(u?10:0),patternsize:parseInt(D,10)+(u?-5:0)+3,pattern:C,};try{b(v)}catch(j){throw"can't decode hash, outcome preset is invalid"+j}return v}function b(h){var g=false;var i="";if(typeof h.hue!="number"){i+=(g?", ":"")+"hue must be numeric";g=true}if(h.hue<0){i+=(g?", ":"")+"hue must be >= 0";g=true}if(h.hue>360){i+=(g?", ":"")+"hue must be <= 360";g=true}if(typeof h.saturation!="number"){i+=(g?", ":"")+"saturation must be numeric";g=true}if(h.saturation<0){i+=(g?", ":"")+"saturation must be >= 0";g=true}if(h.saturation>100){i+=(g?", ":"")+"saturation must be <= 100";g=true}if(typeof h.lightness!="number"){i+=(g?", ":"")+"lightness must be numeric";g=true}if(h.lightness<0){i+=(g?", ":"")+"lightness must be >= 0";g=true}if(h.lightness>100){i+=(g?", ":"")+"lightness must be <= 100";g=true}if(typeof h.highlight!="number"){i+=(g?", ":"")+"highlight must be numeric";g=true}if(h.highlight<0){i+=(g?", ":"")+"highlight must be >= 0";g=true}if(h.highlight>12){i+=(g?", ":"")+"highlight must be <= 12";g=true}if(typeof h.noise!="number"){i+=(g?", ":"")+"noise must be numeric";g=true}if(h.noise<0){i+=(g?", ":"")+"noise must be >= 0";g=true}if(h.noise>12){i+=(g?", ":"")+"noise must be <= 12";g=true}if(typeof h.patternsize!="number"){i+=(g?", ":"")+"patternsize must be numeric";g=true}if(h.patternsize%1!==0){i+=(g?", ":"")+"patternsize must be integer";g=true}if(h.patternsize<3){i+=(g?", ":"")+"patternsize must be >= 3";g=true}if(h.patternsize>7){i+=(g?", ":"")+"patternsize must be <= 7";g=true}if(typeof h.pattern!="object"){i+=(g?", ":"")+"pattern must be object";g=true}if(h.pattern.length!=49){i+=(g?", ":"")+"pattern must have 49 elements";g=true}if(g){throw i}}Raven.config("https://1648a82633344b35b25b63cd70a889c4:2a3a86b59df8442fb1f23e06a0d362a3@app.getsentry.com/1083");window.onerror=Raven.process;if(window.document.location.hash){try{var e=a(window.document.location.hash.substr(1))}catch(d){_gaq.push(["_trackEvent","Bad Hash","Page Load",window.document.location.hash.substr(1)]);var e=a("9j65z2q4jerqh0ni8");alert("Sorry, something's wrong with that pattern")}}else{var e={hue:207,saturation:50,lightness:25,highlight:4,noise:8,patternsize:5,pattern:[true,true,false,true,false,false,false,true,true,false,true,false,false,false,true,true,false,true,false,false,false,true,true,false,true,false,false,false,true,true,false,true,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false],file:"0d71ed6e5cfbf61dc4c73f04e8b76237_final.png"}}$("#tile").foobar(e);$("#hueslider").slider({orientation:"horizontal",min:0,max:360,value:e.hue,slide:function(g,h){e.hue=h.value;$("#tile").foobar(e);$("#saturationslider").css({background:"-webkit-gradient(linear, left top, right top, from(hsl("+e.hue+", 100%, 50%)), to(hsl("+e.hue+", 0%, 50%)))"}).css({background:"-moz-linear-gradient(top, hsl("+e.hue+", 100%, 50%), hsl("+e.hue+", 0%, 50%))"})},stop:function(g,h){$("body").data("ignore_hash_change",true);window.document.location.hash=f(e)},}).append('<div class="ui-slider-bg"></div>');$("#saturationslider").squiggles({valueX:100-e.saturation,valueY:e.lightness,slide:function(g,h){e.saturation=100-h.value.x;e.lightness=h.value.y;$("#tile").foobar(e)},stop:function(g,h){$("body").data("ignore_hash_change",true);window.document.location.hash=f(e)}}).css({background:"-webkit-gradient(linear, left top, right top, from(hsl("+e.hue+", 100%, 50%)), to(hsl("+e.hue+", 0%, 50%)))"}).css({background:"-moz-linear-gradient(top, hsl("+e.hue+", 100%, 50%), hsl("+e.hue+", 0%, 50%))"}).append('<div class="ui-slider-bg"></div>');$("#pixelsslider").slider({orientation:"horizontal",min:3,max:7,step:1,value:e.patternsize,slide:function(g,h){e.patternsize=h.value;$("#pixels").pixels({patternsize:e.patternsize,pattern:e.pattern});$("#tile").foobar(e)},stop:function(g,h){$("body").data("ignore_hash_change",true);window.document.location.hash=f(e)}}).append('<div class="ui-slider-bg"></div>');$("#pixels").pixels({patternsize:e.patternsize,pattern:e.pattern,change:function(g,h){e.pattern=this.options.pattern;$("#tile").foobar(e);$("body").data("ignore_hash_change",true);window.document.location.hash=f(e)}});$("#highlightslider").slider({orientation:"horizontal",min:0,max:12,step:0.01,value:e.highlight,slide:function(g,h){e.highlight=h.value;$("#tile").foobar(e)},stop:function(g,h){$("body").data("ignore_hash_change",true);window.document.location.hash=f(e)}}).append('<div class="ui-slider-bg"></div>');$("#noiseslider").slider({orientation:"horizontal",min:0,max:12,step:0.01,value:e.noise,slide:function(g,h){e.noise=h.value;$("#tile").foobar(e)},stop:function(g,h){$("body").data("ignore_hash_change",true);window.document.location.hash=f(e)}}).append('<div class="ui-slider-bg"></div>');$("#download").click(function(g,h){$("#tile").foobar("downloadtile",e)});$(window).resize(function(){$("#tile").foobar(e)});function c(h){_gaq.push(["_trackPageview",location.pathname+location.search+location.hash]);if($("body").data("ignore_hash_change")===false){try{e=a(window.document.location.hash.substr(1))}catch(g){_gaq.push(["_trackEvent","Bad Hash","Hash Change",window.document.location.hash.substr(1)]);e=a("9j65z2q4jerqh0ni8");alert("Sorry, something's wrong with that pattern")}$("#tile").foobar(e);$("#hueslider").slider("value",e.hue);$("#saturationslider").squiggles("value",{x:100-e.saturation,y:e.lightness}).css({background:"-webkit-gradient(linear, left top, right top, from(hsl("+e.hue+", 100%, 50%)), to(hsl("+e.hue+", 0%, 50%)))"}).css({background:"-moz-linear-gradient(top, hsl("+e.hue+", 100%, 50%), hsl("+e.hue+", 0%, 50%))"});$("#pixelsslider").slider("value",e.patternsize);$("#pixels").pixels(e).pixels("pixels",e.pattern);$("#highlightslider").slider("value",e.highlight);$("#noiseslider").slider("value",e.noise)}$("body").data("ignore_hash_change",false)}$("body").data("ignore_hash_change",false);$(window).bind("hashchange",c);if(!window.document.location.hash){$("body").data("ignore_hash_change",true);window.document.location.hash=f(e)}});